<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>figma plugin test</title>
    <!-- <link rel="stylesheet" type="text/css" href="source/Bootstrap/bootstrap.css"> -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="compiled/css/ui.css">
    <!-- font awesome stuff -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <!-- <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.2.0/css/all.css" integrity="sha384-hWVjflwFxL6sNzntih27bfxkr27PmbbK/iSvJ+a4+0owXq79v+lsFkW54bOGbiDQ" crossorigin="anonymous"> -->

    <!-- font -->
    <!-- <link href="https://fonts.googleapis.com/css?family=Indie+Flower%7CPermanent+Marker" rel="stylesheet"> -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel="stylesheet">

    <!-- jquery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  </head>
  <body>
    <h2>Task Manager</h2>
    <div class="box">
        <div class="title">
            <div id="list" class="title-child active">
                <p>To-Do</p>
                <p class="todo" id="todoCount"></p>
            </div>
            <div id="completed" class="title-child">
                <p>Completed</p>
                <p class="done" id="doneCount"></p>
            </div>
        </div>
        <form action="create" id="form" class="drag-list">
            <input type="text" class="drag-item task 0" draggable="true" placeholder="+ Add New Task"  oninput="typed(0)">
        </form>
        <form action="display" id="done"></form>

        <!-- <input type="text" id="field1">
        <button onclick="setCookie()">Save Data</button> -->

        <!-- <button id="create">Add New Task</button> -->
        <!-- <button id="delete">Delete Task</button> -->
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
    <script>
        $('#done').hide();
        var doneCount = document.getElementById('done').getElementsByTagName('input').length;
        document.getElementById('doneCount').innerHTML = doneCount;
        var doneCount = document.getElementById('form').getElementsByTagName('input').length;
        document.getElementById('todoCount').innerHTML = doneCount - 1;

        count = 0;

        function newTask(index) {
            let newInput = document.createElement('input');
            newInput.setAttribute('type',"text");
            newInput.setAttribute('class',"drag-item task " + index);
            newInput.setAttribute('draggable', true);
            newInput.setAttribute('placeholder',"+ Add New Task");
            newInput.setAttribute('oninput',"typed(" + index + ")");

            return newInput;
        }

        function doneTask(index, place, entry) {
            let done = document.createElement('input');
            done.setAttribute('type',"text");
            done.setAttribute('class',"drag-item task "+ index);
            done.setAttribute('draggable', true);
            done.setAttribute('value', entry);
            done.setAttribute('oninput',"typed(" + place + ")");
            document.getElementById('done').appendChild(done);
            let open = document.createElement('button');
            let attr = 'btn btn-primary reopen ' + index;
            open.setAttribute('class', attr);
            open.setAttribute("type", 'button');
            open.setAttribute("onclick", 'reopen('+ index +')');
            open.innerHTML = 'x';
            document.getElementById('done').appendChild(open);
        }

        function reopenTask(index, entry) {
            let reopenbtn = document.createElement('button');
            let attr = 'btn btn-primary reopen ' + index;
            reopenbtn.setAttribute('class', attr);
            reopenbtn.setAttribute("type", 'button');
            reopenbtn.setAttribute("onclick", 'finished('+ index +')');
            reopenbtn.innerHTML = 'x';
            document.getElementById('form').prepend(reopenbtn);
            let reopen = document.createElement('input');
            reopen.setAttribute('type',"text");
            reopen.setAttribute('class',"drag-item task "+ index);
            reopen.setAttribute('draggable', true);
            reopen.setAttribute('value', entry);
            document.getElementById('form').prepend(reopen);
        }

        function typed(update) {
            let size = document.querySelectorAll('.task').length;
            let input = document.querySelectorAll('.task')[size-1];
            
            if (input.value != '') {
                let close = document.createElement('button');
                let attr = 'btn btn-primary delete ' + update;
                close.setAttribute('class', attr);
                close.setAttribute("type", 'button');
                close.setAttribute("onclick", 'finished('+ update +')');
                close.innerHTML = 'x';
                document.getElementById('form').appendChild(close);

                count += 1;
                document.getElementById('form').appendChild(newTask(count));

                var doneCount = document.getElementById('done').getElementsByTagName('input').length;
                document.getElementById('doneCount').innerHTML = doneCount;
                var doneCount = document.getElementById('form').getElementsByTagName('input').length;
                document.getElementById('todoCount').innerHTML = doneCount - 1;
            }
        }

        function finished(index) {
            let tasklist = document.getElementById('form').getElementsByTagName('input');
            let tasklistbtn = document.getElementById('form').getElementsByTagName('button');

            for(let i=0; i<tasklist.length; i++) {
                let value = tasklist[i].classList[2];
                if (value == index) {
                    var place = tasklist[i];
                    var btn = tasklistbtn[i]
                }
            }

            let entry = place.value;
            doneTask(index, place, entry);

            place.remove();
            btn.remove();

            var doneCount = document.getElementById('done').getElementsByTagName('input').length;
            document.getElementById('doneCount').innerHTML = doneCount;
            var doneCount = document.getElementById('form').getElementsByTagName('input').length;
            document.getElementById('todoCount').innerHTML = doneCount - 1;
        }

        function reopen(index) {
            let tasklist = document.getElementById('done').getElementsByTagName('input');
            let tasklistbtn = document.getElementById('done').getElementsByTagName('button');

            for(let i=0; i<tasklist.length; i++) {
                let value = tasklist[i].classList[1];
                if (value == index) {
                    var place = tasklist[i];
                    var btn = tasklistbtn[i]
                }
            }

            let entry = place.value;
            reopenTask(index, entry);
          

            place.remove();
            btn.remove();
            var doneCount = document.getElementById('done').getElementsByTagName('input').length;
            document.getElementById('doneCount').innerHTML = doneCount;
            var doneCount = document.getElementById('form').getElementsByTagName('input').length;
            document.getElementById('todoCount').innerHTML = doneCount - 1;
        }

        document.getElementById('completed').onclick = () => {
            $('#list').removeClass('active');
            $('#form').hide();
            $('#completed').addClass('active');
            $('#done').show();
        }
        document.getElementById('list').onclick = () => {
            $('#list').addClass('active');
            $('#form').show();
            $('#completed').removeClass('active');
            $('#done').hide();
        }
        
        const dragList = document.getElementById('form');
        let draggedItem = null;

        dragList.addEventListener('dragstart', handleDragStart);
        dragList.addEventListener('dragover', handleDragOver);
        dragList.addEventListener('drop', handleDrop);

        function handleDragStart(event) {
            draggedItem = event.target;
            event.dataTransfer.effectAllowed = 'move';
            event.dataTransfer.setData('text/html', draggedItem.innerHTML);
            event.target.style.opacity = '0.5';
        }

        function handleDragOver(event) {
            event.preventDefault();
            event.dataTransfer.dropEffect = 'move';
            const targetItem = event.target;
            if (targetItem !== draggedItem && targetItem.classList.contains('drag-item')) {
                    const boundingRect = targetItem.getBoundingClientRect();
                    const offset = boundingRect.y + (boundingRect.height / 2);
                if (event.clientY - offset > 0) {
                    targetItem.style.borderBottom = 'solid 2px #000';
                    targetItem.style.borderTop = '';
                } else {
                    targetItem.style.borderTop = 'solid 2px #000';
                    targetItem.style.borderBottom = '';
                }
            }
        }

        function handleDrop(event) {
            event.preventDefault();
            const targetItem = event.target;
            if (targetItem !== draggedItem && targetItem.classList.contains('drag-item')) {
                if (event.clientY > targetItem.getBoundingClientRect().top + (targetItem.offsetHeight / 2)) {
                    targetItem.parentNode.insertBefore(draggedItem, targetItem.nextSibling);
                } else {
                    targetItem.parentNode.insertBefore(draggedItem, targetItem);
                }
            }
            targetItem.style.borderTop = '';
            targetItem.style.borderBottom = '';
            draggedItem.style.opacity = '';
            draggedItem = null;
        }
    </script>  
</body>
</html>
